<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Best Practices: working with Viva Insights in R • vivainsights</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Best Practices: working with Viva Insights in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vivainsights</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.1.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-analyst-guide" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Analyst Guide</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-analyst-guide">
<li><a class="dropdown-item" href="../analyst_guide_intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../analyst_guide_getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../analyst_guide_data_validation.html">Data Validation</a></li>
    <li><a class="dropdown-item" href="../analyst_guide_reports.html">Reports</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro-to-vivainsights.html">Introduction to vivainsights</a></li>
    <li><a class="dropdown-item" href="../articles/best-practices.html">Best Practices when using vivainsights</a></li>
    <li><a class="dropdown-item" href="../articles/network-analysis.html">Introduction to Organizational Network Analysis with vivainsights in R</a></li>
    <li><a class="dropdown-item" href="../articles/exploratory-rank.html">Identifying noteworthy groups with rank functions</a></li>
    <li><a class="dropdown-item" href="../articles/pairwise-chisq.html">Running pairwise chi-square tests with vivainsights</a></li>
    <li><a class="dropdown-item" href="../articles/information-value.html">Information Value analysis with vivainsights</a></li>
    <li><a class="dropdown-item" href="../articles/custom-network-p2p.html">Plotting a Network Graph using network_p2p</a></li>
    <li><a class="dropdown-item" href="../articles/custom-network-g2g.html">Plotting a Network Graph using network_g2g</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../faq.html">FAQ</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/microsoft/vivainsights/"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Best Practices: working with Viva Insights in R</h1>
                        <h4 data-toc-skip class="author">Martin
Chan</h4>
            
            <h4 data-toc-skip class="date">2023-11-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/microsoft/vivainsights/blob/main/vignettes/best-practices.Rmd" class="external-link"><code>vignettes/best-practices.Rmd</code></a></small>
      <div class="d-none name"><code>best-practices.Rmd</code></div>
    </div>

    
    
<p>This post details the top best practices for working with Viva
Insights data in R. Code examples in this post make use of the
<strong>vivainsights</strong> and the <strong>dplyr</strong>
packages.</p>
<div class="section level2">
<h2 id="use-import_wpa">1. Use <code>import_wpa()</code><a class="anchor" aria-label="anchor" href="#use-import_wpa"></a>
</h2>
<p>We always recommend using <code><a href="../reference/import_query.html">import_query()</a></code> for reading in
CSV queries as it is optimised for the <strong>vivainsights</strong>
package, applying certain checks as well as variable classifications
based on what is expected from the Viva Insights data. In effect,
<code><a href="../reference/import_query.html">import_query()</a></code> is a substitute for <code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv()</a></code>,
<code>readr::read_csv()</code>, or <code><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">data.table::fread()</a></code>,
whichever is your usual go-to CSV reader.</p>
</div>
<div class="section level2">
<h2 id="validate-your-data">2. Validate your data!<a class="anchor" aria-label="anchor" href="#validate-your-data"></a>
</h2>
<p>Data validation is important - and with the R package, this is as
simple as running <code><a href="../reference/validation_report.html">validation_report()</a></code> on the existing
data.</p>
<p>You would simply run it on the data frame containing the query:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://microsoft.github.io/vivainsights/">vivainsights</a></span><span class="op">)</span></span>
<span><span class="va">pq_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/validation_report.html">validation_report</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="give-informative-names-to-your-queries">3. Give informative names to your queries<a class="anchor" aria-label="anchor" href="#give-informative-names-to-your-queries"></a>
</h2>
<p>This is up to individual preferences, but here is a case for giving
informative and slightly more elaborative names to queries. First, it
will make it easy for you or your fellow analysts to have an idea of
what is in the CSV file prior to reading in the data. Moreover, clear
and informative names can help analysts avoid errors at the mid-stage of
the analysis, where it is likely that numerous queries have been run,
and it is imaginably confusing if they all have generic names like
<em>Collaboration Assessment1.csv</em> or <em>Person Query
v5a.csv</em>.</p>
<p>We propose to get the name right from the start at the tenant, so
that the name of the query on the tenant is consistent with the name of
the query saved on your local machine. Here is an example of an
informative query name:</p>
<p><code>PQ_May18toJune19_SalesOnly_MyInitials_20200923</code></p>
<p>where:</p>
<ul>
<li>
<code>PQ</code> stands for <em>Person Query</em>
</li>
<li>
<code>May18toJune19</code> stands for the date range in which the
query covers</li>
<li>
<code>SalesOnly</code> means that the query is covering the Sales
organization only</li>
<li>
<code>MyInitials</code> are the initials of the analyst who ran this
query.</li>
<li>
<code>20200923</code> is the date when you ran the query.</li>
</ul>
</div>
<div class="section level2">
<h2 id="keep-your-r-files-short-and-use-source">4. Keep your R files short and use <code>source()</code><a class="anchor" aria-label="anchor" href="#keep-your-r-files-short-and-use-source"></a>
</h2>
<p>Although there isn’t an universal guide on what the maximum
<em>length</em> of an individual R file should be, there is a good case
for keeping an R file within 400 lines of code. The main reason is
because it keeps the code easy to navigate, and you won’t have to do a
lot of scrolling or advanced search to find out where you wrote a
specific chunk of code.</p>
<p>To help keep your R files short, it is recommended that you use
<code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code>, which tells R to run another R script on your
machine. For instance, you could use
<code>source("myscripts/data_cleaning.R")</code> to run a script called
<code>data_cleaning.R</code> which contains some upfront code that loads
and prepares your data for analysis. You can also achieve the same with
functions.</p>
</div>
<div class="section level2">
<h2 id="use-person-level-averages">5. Use person-level averages<a class="anchor" aria-label="anchor" href="#use-person-level-averages"></a>
</h2>
<p>It is recommended to use <em>person-level averages</em> where
possible. What this means is that for any given metric, you would
calculate an average for each employee before you would calculate it for
the group. This effectively avoids people who may be represented by more
person-weeks in the data (e.g. they have been in the company for longer)
to have their results skew the data. In R, this can be replicated by
grouping and summarising the data twice:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">vivasights</span><span class="op">)</span></span>
<span><span class="va">pq_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PersonId</span>, <span class="va">Organization</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Collaboration_hours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Collaboration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Organization</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Collaboration_hours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Collaboration_hours</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>All of the functions in the <strong>vivainsights</strong> package
already calculate averages this way, so it is recommended that you use
the package functions directly where possible. The above example is
replicated by the following functions from the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pq_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/collaboration_sum.html">collaboration_sum</a></span><span class="op">(</span>hrvar <span class="op">=</span> <span class="st">"Organization"</span>, return <span class="op">=</span> <span class="st">"table"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or</span></span>
<span></span>
<span><span class="va">pq_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/create_bar.html">create_bar</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"Collaboration_hours"</span>, hrvar <span class="op">=</span> <span class="st">"Organization"</span>, return <span class="op">=</span> <span class="st">"table"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="ensure-you-adhere-to-privacy-thresholds">6. Ensure you adhere to privacy thresholds<a class="anchor" aria-label="anchor" href="#ensure-you-adhere-to-privacy-thresholds"></a>
</h2>
<p>Privacy is an essential element of Viva Insights, so make sure you
respect the privacy thresholds in your analysis. To do this, ensure you
always calculate the number of distinct persons
(<code>n_distinct(PersonId)</code> is one way to do it) for each
sub-group that you are analysing, and make sure you do not display any
data that goes below the threshold setting. All of the functions in the
<strong>vivainsights</strong> package already do this, and you can
adjust the threshold setting with the argument <code>mingroup</code>,
which defaults to 5.</p>
</div>
<div class="section level2">
<h2 id="comment-why-not-what">7. Comment WHY, not WHAT<a class="anchor" aria-label="anchor" href="#comment-why-not-what"></a>
</h2>
<p>To make it easy for others and your future self to understand your
code, comments (<code>#</code>) are essential. However, it is easy to go
overboard and over-comment. The best practice principle here is then to
comment on <em>why</em> you are doing something in a certain way, rather
than <em>what</em> you are doing, as the rationale is that it is often
obvious for the reader <em>what</em> you are doing (e.g. filtering,
selecting columns) but less obvious <em>why</em>.</p>
</div>
<div class="section level2">
<h2 id="when-youve-written-the-same-code-3-times-write-a-function">8. When you’ve written the same code 3 times, write a function<a class="anchor" aria-label="anchor" href="#when-youve-written-the-same-code-3-times-write-a-function"></a>
</h2>
<p>This “best practice” suggestion actually came from a popular <a href="https://twitter.com/drob/status/928447584712253440" class="external-link">tweet</a> by
Data Scientist and R educator David Robinson. This basically captures
the DRY (Don’t Repeat Yourself) principle in programming. There are
several advantages of writing functions, which one of them includes the
fact that you can just change the function once, and all the changes
would be applied to <strong>everywhere</strong> in your script where
that function is used. Just consider the following example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter Organization by Sales and extract number of distinct people</span></span>
<span><span class="va">pq_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Organization</span> <span class="op">==</span> <span class="st">"Sales"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">PersonId</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter Organization by Operations and extract number of distinct people</span></span>
<span><span class="va">pq_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Organization</span> <span class="op">==</span> <span class="st">"Operations"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">PersonId</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter Organization by Engineering and extract number of distinct people</span></span>
<span><span class="va">pq_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Organization</span> <span class="op">==</span> <span class="st">"Engineering"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">PersonId</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>versus the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filt_org</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">filter_string</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pq_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Organization</span> <span class="op">==</span> <span class="va">filter_string</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">PersonId</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">filt_org</span><span class="op">(</span><span class="st">"Sales"</span><span class="op">)</span></span>
<span><span class="fu">filt_org</span><span class="op">(</span><span class="st">"Operations"</span><span class="op">)</span></span>
<span><span class="fu">filt_org</span><span class="op">(</span><span class="st">"Engineering"</span><span class="op">)</span></span></code></pre></div>
<p>The second chunk is much more readable, much more easier to edit, and
also more elegant than the first approach of explicitly coding out
everything.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Chan, Carlos Morales.</p>
</div>

<div class="pkgdown-footer-right">
  <p>NULL Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
